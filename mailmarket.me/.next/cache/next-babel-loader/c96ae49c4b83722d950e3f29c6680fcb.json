{"ast":null,"code":"import { Base64 } from \"js-base64\";\nimport mongodb from \"mongodb\";\nimport smtpc from \"smtpc\";\nconst MongoClient = mongodb.MongoClient;\nconst uri = \"mongodb+srv://main-user:09730Success@mailmarketme-k4esh.mongodb.net/test?retryWrites=true&w=majority\";\nconst client = new MongoClient(uri, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true\n});\nexport default ((req, res) => {\n  if (req.method === \"POST\" && req.body.id != undefined && req.body.id != null && req.body.pointsToUse != undefined && req.body.pointsToUse != null && req.body.customEmailList != undefined && req.body.customEmailList != null && req.body.msgToSend != undefined && req.body.msgToSend != null) {\n    client.connect(err => {\n      if (err) throw err;\n      const db = client.db(\"MailMarketMe\");\n      db.collection(\"accounts\").findOne({\n        _id: mongodb.ObjectId(Base64.decode(req.body.id))\n      }, (err, result) => {\n        if (req.body.pointsToUse <= result.points) {\n          db.collection(\"accounts\").updateOne({\n            _id: mongodb.ObjectId(Base64.decode(req.body.id))\n          }, {\n            $set: {\n              points: result.points - req.body.pointsToUse,\n              totalEmailsSent: req.body.pointsToUse + result.totalEmailsSent\n            }\n          }, err => {\n            if (err) throw err;\n          });\n          let mailsToSet = db.collection(\"emails\").find({}).limit(parseInt(req.body.pointsToUse));\n          let mailList = req.body.customEmailList.replace(\" \", \", \");\n          smtpc.sendmail({\n            \"host\": \"mbox.contact.bg\",\n            \"auth\": [\"mailmarketme@mbox.contact.bg\", \"09730Success\"],\n            \"from\": \"selyatinismet@lololo.com\",\n            \"to\": \"selyatinismet@gmail.com\",\n            \"content\": {\n              \"subject\": \"HAAAAA\",\n              \"content-type\": \"text/html\",\n              \"content\": \"<h1>HAAAAAAAAAAA</h1>\"\n            },\n            \"failure\": err => {\n              console.log(err);\n            }\n          }); // Send the emails \n\n          res.status(200).end();\n        } else {\n          res.status(406).end();\n        }\n      });\n    });\n  } else {\n    res.status(406).end();\n  }\n});","map":{"version":3,"sources":["/Users/mac/Desktop/Web Apps/MailMarket.me/mailmarket.me/pages/api/mailer.js"],"names":["Base64","mongodb","smtpc","MongoClient","uri","client","useNewUrlParser","useUnifiedTopology","req","res","method","body","id","undefined","pointsToUse","customEmailList","msgToSend","connect","err","db","collection","findOne","_id","ObjectId","decode","result","points","updateOne","$set","totalEmailsSent","mailsToSet","find","limit","parseInt","mailList","replace","sendmail","console","log","status","end"],"mappings":"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","sourcesContent":["import { Base64 } from \"js-base64\";\nimport mongodb from \"mongodb\";\nimport smtpc from \"smtpc\";\nconst MongoClient = mongodb.MongoClient;\nconst uri = \"mongodb+srv://main-user:09730Success@mailmarketme-k4esh.mongodb.net/test?retryWrites=true&w=majority\";\n\nconst client = new MongoClient(uri, { useNewUrlParser: true, useUnifiedTopology: true });\n\nexport default (req, res) => {\n    if (req.method === \"POST\" && req.body.id != undefined && req.body.id != null && req.body.pointsToUse != undefined && req.body.pointsToUse != null && req.body.customEmailList != undefined && req.body.customEmailList != null && req.body.msgToSend != undefined && req.body.msgToSend != null) {\n        client.connect(err => {\n            if (err) throw err;\n            const db = client.db(\"MailMarketMe\");\n            db.collection(\"accounts\").findOne({ _id: mongodb.ObjectId(Base64.decode(req.body.id)) }, (err, result) => {\n                if (req.body.pointsToUse <= result.points) {\n                    db.collection(\"accounts\").updateOne({ _id: mongodb.ObjectId(Base64.decode(req.body.id)) },\n                        {\n                            $set: {\n                                points: result.points - req.body.pointsToUse,\n                                totalEmailsSent: req.body.pointsToUse + result.totalEmailsSent\n                            }\n                        },\n                        err => { if (err) throw err }\n                    );\n\n                    let mailsToSet = db.collection(\"emails\").find({}).limit(parseInt(req.body.pointsToUse));\n                    let mailList = req.body.customEmailList.replace(\" \", \", \");\n\n                    smtpc.sendmail({\n                        \"host\": \"mbox.contact.bg\",\n                        \"auth\": [\"mailmarketme@mbox.contact.bg\", \"09730Success\"],\n                        \"from\": \"selyatinismet@lololo.com\",\n                        \"to\": \"selyatinismet@gmail.com\",\n                        \"content\": {\n                            \"subject\": \"HAAAAA\",\n                            \"content-type\": \"text/html\",\n                            \"content\": \"<h1>HAAAAAAAAAAA</h1>\"\n                        },\n                        \"failure\": err => {\n                            console.log(err);\n                        }\n                    })\n\n                        \n                        // Send the emails \n                        res.status(200).end();\n                    }else {\n                        res.status(406).end();\n                    }\n        });\n        });\n    }\n    else {\n        res.status(406).end();\n    }\n}"]},"metadata":{},"sourceType":"module"}