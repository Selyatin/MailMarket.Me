{"ast":null,"code":"import { Base64 } from \"js-base64\";\nimport mongodb from \"mongodb\";\nimport simplesmtp from \"node-smtp-client\";\nconst MongoClient = mongodb.MongoClient;\nconst uri = \"mongodb+srv://main-user:09730Success@mailmarketme-k4esh.mongodb.net/test?retryWrites=true&w=majority\";\nconst client = new MongoClient(uri, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true\n});\nconst mailerClient = simplesmtp.Mail({\n  host: \"mbox.contact.bg\",\n  secure: false,\n  username: \"mailmarketme@mbox.contact.bg\",\n  password: \"09730Success\"\n});\nexport default ((req, res) => {\n  if (req.method === \"POST\" && req.body.id != undefined && req.body.id != null && req.body.pointsToUse != undefined && req.body.pointsToUse != null && req.body.customEmailList != undefined && req.body.customEmailList != null && req.body.msgToSend != undefined && req.body.msgToSend != null) {\n    client.connect(err => {\n      if (err) throw err;\n      const db = client.db(\"MailMarketMe\");\n      db.collection(\"accounts\").findOne({\n        _id: mongodb.ObjectId(Base64.decode(req.body.id))\n      }, (err, result) => {\n        if (req.body.pointsToUse <= result.points) {\n          db.collection(\"accounts\").updateOne({\n            _id: mongodb.ObjectId(Base64.decode(req.body.id))\n          }, {\n            $set: {\n              points: result.points - req.body.pointsToUse,\n              totalEmailsSent: req.body.pointsToUse + result.totalEmailsSent\n            }\n          }, err => {\n            if (err) throw err;\n          });\n          let mailsToSet = db.collection(\"emails\").find({}).limit(parseInt(req.body.pointsToUse));\n          let mailList = req.body.customEmailList.replace(\" \", \", \");\n          mailerClient.message({\n            from: \"selyatinismet@lololo.com\",\n            to: [\"selyatinismet@gmail.com\"],\n            subject: \"HAAAAA\"\n          }).body(\"<h1>HAAA</h1>\").send(err => console.log(err)); // Send the emails \n\n          res.status(200).end();\n        } else {\n          res.status(406).end();\n        }\n      });\n    });\n  } else {\n    res.status(406).end();\n  }\n});","map":{"version":3,"sources":["/Users/mac/Desktop/Web Apps/MailMarket.me/mailmarket.me/pages/api/mailer.js"],"names":["Base64","mongodb","simplesmtp","MongoClient","uri","client","useNewUrlParser","useUnifiedTopology","mailerClient","Mail","host","secure","username","password","req","res","method","body","id","undefined","pointsToUse","customEmailList","msgToSend","connect","err","db","collection","findOne","_id","ObjectId","decode","result","points","updateOne","$set","totalEmailsSent","mailsToSet","find","limit","parseInt","mailList","replace","message","from","to","subject","send","console","log","status","end"],"mappings":"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","sourcesContent":["import { Base64 } from \"js-base64\";\nimport mongodb from \"mongodb\";\nimport simplesmtp from \"node-smtp-client\";\nconst MongoClient = mongodb.MongoClient;\nconst uri = \"mongodb+srv://main-user:09730Success@mailmarketme-k4esh.mongodb.net/test?retryWrites=true&w=majority\";\n\nconst client = new MongoClient(uri, { useNewUrlParser: true, useUnifiedTopology: true });\n\nconst mailerClient = simplesmtp.Mail({\n    host: \"mbox.contact.bg\",\n    secure: false,\n    username: \"mailmarketme@mbox.contact.bg\",\n    password: \"09730Success\",\n})\n\nexport default (req, res) => {\n    if (req.method === \"POST\" && req.body.id != undefined && req.body.id != null && req.body.pointsToUse != undefined && req.body.pointsToUse != null && req.body.customEmailList != undefined && req.body.customEmailList != null && req.body.msgToSend != undefined && req.body.msgToSend != null) {\n        client.connect(err => {\n            if (err) throw err;\n            const db = client.db(\"MailMarketMe\");\n            db.collection(\"accounts\").findOne({ _id: mongodb.ObjectId(Base64.decode(req.body.id)) }, (err, result) => {\n                if (req.body.pointsToUse <= result.points) {\n                    db.collection(\"accounts\").updateOne({ _id: mongodb.ObjectId(Base64.decode(req.body.id)) },\n                        {\n                            $set: {\n                                points: result.points - req.body.pointsToUse,\n                                totalEmailsSent: req.body.pointsToUse + result.totalEmailsSent\n                            }\n                        },\n                        err => { if (err) throw err }\n                    );\n\n                    let mailsToSet = db.collection(\"emails\").find({}).limit(parseInt(req.body.pointsToUse));\n                    let mailList = req.body.customEmailList.replace(\" \", \", \");\n                    \n                    mailerClient.message({\n                        from: \"selyatinismet@lololo.com\",\n                        to: [\"selyatinismet@gmail.com\"],\n                        subject: \"HAAAAA\",\n                    }).body(\"<h1>HAAA</h1>\").send(err => console.log(err));\n                        \n                        // Send the emails \n                        res.status(200).end();\n                    }else {\n                        res.status(406).end();\n                    }\n        });\n        });\n    }\n    else {\n        res.status(406).end();\n    }\n}"]},"metadata":{},"sourceType":"module"}